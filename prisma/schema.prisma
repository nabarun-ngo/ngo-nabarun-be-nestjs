// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js" 
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

model UserProfile {
  id          String    @id
  title       String?   @db.VarChar(5)
  firstName   String    @db.VarChar(50)
  middleName  String?   @db.VarChar(50)
  lastName    String    @db.VarChar(50)
  dateOfBirth DateTime?
  gender      String?   @db.VarChar(10)
  about       String?   @db.VarChar(200)
  picture     String?

  // Relations
  roles            UserRole[]
  phoneNumbers     PhoneNumber[]
  addresses        Address[]
  socialMediaLinks Link[]

  email              String    @unique @db.VarChar(100)
  isPublic           Boolean?
  authUserId         String?   @db.VarChar(100)
  status             String    @db.VarChar(20)
  isTemporary        Boolean
  isSameAddress      Boolean?
  loginMethods       String?   @db.VarChar(20)
  panNumber          String?   @db.VarChar(20)
  aadharNumber       String?   @db.VarChar(20)
  donationPauseStart DateTime?
  donationPauseEnd   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  version   BigInt   @default(0)

  @@map("user_profiles")
}

model UserRole {
  id           String @id
  roleCode     String @db.VarChar(20)
  roleName     String @db.VarChar(50)
  authRoleCode String @db.VarChar(20)

  // Relation to UserProfile (UserEntity in JPA)
  user   UserProfile @relation(fields: [userId], references: [id])
  userId String

  createdAt DateTime  @default(now())
  createdBy String?   @db.VarChar(255)
  expireAt  DateTime?
  version   BigInt    @default(0)

  @@map("user_roles")
}

model PhoneNumber {
  id          String  @id @default(uuid())
  phoneCode   String?
  phoneNumber String?
  hidden      Boolean @default(false)
  primary     Boolean @default(false)

  user   UserProfile @relation(fields: [userId], references: [id])
  userId String

  version BigInt @default(0)

  @@map("phone_numbers")
}

model Link {
  id        String @id @default(uuid())
  linkName  String @db.VarChar(20)
  linkType  String @db.VarChar(20)
  linkValue String @db.VarChar(50)

  // Relation to UserProfile (UserEntity in JPA)
  user   UserProfile? @relation(fields: [userId], references: [id])
  userId String?     

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  version   BigInt   @default(0)

  @@map("links")
}

model Address {
  id           String      @id @default(uuid())
  addressLine1 String?
  addressLine2 String?
  addressLine3 String?
  hometown     String?
  zipCode      String?
  state        String?
  district     String?
  country      String?
  addressType  String
  // Relation to UserProfile (UserEntity in JPA)
  user         UserProfile @relation(fields: [userId], references: [id])
  userId       String

  version BigInt @default(0)

  @@map("addresses")
}

model OAuthToken {
  id            String   @id @default(uuid())
  provider      String   @db.VarChar(20) // e.g., 'google', 'gmail'
  clientId      String   @db.VarChar(100) // OAuth client ID
  email         String   @db.VarChar(100) // Gmail address associated with token
  accessToken   String   @db.Text // Encrypted access token
  refreshToken  String?  @db.Text // Encrypted refresh token
  tokenType     String?  @db.VarChar(20) // Usually 'Bearer'
  expiresAt     DateTime? // Token expiration time
  scope         String?  @db.Text // OAuth scopes
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
 
  @@index([email, clientId])
  @@map("oauth_tokens")
}


